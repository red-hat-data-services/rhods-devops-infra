# Use the specified image as the base
FROM registry.access.redhat.com/ubi8:latest

# Run commands as root user
USER root

# Install EPEL repository and update packages
RUN rpm -ivh https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm \
 && dnf update -y \
 && dnf install -y podman tar jq clamav

# Set up user namespaces
RUN echo "root:20000:35536" > /etc/subuid \
 && echo "root:20000:35536" > /etc/subgid

# Create and set permissions on directories
RUN mkdir -p /results /app \
 && chown 1001:0 /results /app

# Copy the main.sh script into the container
COPY main.sh /app
RUN chown 1001:0 /app/main.sh \
 && chmod a+x /app/main.sh

# Set the command to run when the container starts
CMD ["/app/main.sh"]

